import os

import matplotlib.pyplot as plt
import numpy as np
import pydicom as pdcm

from utility import rle_decode_modified, mask2rle, rle_decode


def make_plots():
    pneumo = "606355 2 1020 8 1015 12 1011 12 1010 14 1009 15 1008 16 1007 17 1006 18 1005 19 1004 20 1003 21 1003 20 1003 21 1003 21 1002 22 1002 21 1002 22 1002 22 1001 23 1001 22 1001 23 1001 23 1001 23 1000 24 1000 23 1000 24 1000 24 1000 24 999 24 1000 24 1000 24 999 25 999 24 1000 24 999 25 999 25 999 24 1000 24 1000 24 1000 24 1000 24 1000 23 1000 24 1000 24 1000 24 1000 24 1000 24 1000 24 1000 24 1000 24 1000 24 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 25 999 26 998 26 998 26 998 26 999 25 999 26 998 26 998 26 998 26 998 27 997 27 997 27 997 27 998 27 997 27 997 27 997 27 998 27 997 27 997 28 996 28 997 28 996 28 996 29 995 29 996 29 995 29 995 29 995 30 995 29 995 30 994 30 995 29 995 30 995 29 995 30 994 30 995 30 994 31 994 30 995 30 994 30 995 30 995 29 995 30 995 29 996 29 995 29 996 29 996 29 995 29 996 29 996 29 995 29 996 29 996 29 995 29 996 29 995 29 996 29 996 28 996 29 996 28 997 28 996 28 997 27 998 27 998 26 998 27 998 26 999 25 999 26 999 25 1000 25 1000 24 1001 24 1001 23 1001 24 1001 23 1002 23 1002 22 1003 21 1004 21 1004 20 1005 20 1005 19 1006 18 1008 17 1008 16 1009 16 1010 14 1011 14 1011 14 1012 12 1013 12 1013 12 1013 11 1014 11 1014 11 1015 9 1016 9 1016 9 1016 9 1016 9 1016 9 1016 9 1016 9 1016 9 1016 10 1015 10 1015 10 1015 11 1014 11 1014 12 1013 12 1014 12 1013 13 1012 13 1013 13 1013 12 1014 11 1015 11 1015 10 1015 10 1016 9 1016 10 1015 10 1016 9 1016 10 1016 9 1016 9 1016 10 1016 9 1016 10 1016 10 1015 11 1014 12 1014 12 1013 13 1012 14 1011 16 1010 16 1009 18 1007 19 1006 20 1006 20 1006 20 1006 19 1007 19 1007 18 1008 18 1008 18 1008 18 1009 17 1009 18 1009 18 1009 17 1009 18 1009 20 1007 24 1002 26 1001 27 1000 26 1000 27 1000 27 1000 26 1000 27 1000 26 1001 25 1001 25 1003 23 1005 20 1008 18 1010 16 1013 13 1015 10"
    rib1 = "768197 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60 964 60"
    rib2 = "778505 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69 955 69"
    rib3 = "780636 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64 960 64"
    tube = "795213 19 1004 1 18 1 1004 1 18 1 1003 1 19 1 1003 1 19 1 1002 1 20 1 1002 1 20 1 1001 1 21 1 1001 1 21 1 1000 1 22 1 1000 1 22 1 999 1 23 1 999 1 23 1 998 1 24 1 998 1 24 1 997 1 25 1 997 1 25 1 996 1 26 1 996 1 26 1 995 1 27 1 995 1 27 1 994 1 28 1 994 1 28 1 994 1 28 1 994 1 28 1 994 1 27 1 995 1 26 1 996 1 25 1 997 1 25 1 997 1 24 1 998 1 23 1 999 1 22 1 1000 1 21 1 1001 1 20 1 1002 1 20 1 1002 1 19 1 1003 1 18 1 1004 1 17 1 1005 1 16 1 929 2 75 1 15 1 932 4 71 1 15 1 936 4 67 1 14 1 941 4 63 1 13 1 946 4 59 1 12 1 951 4 55 1 11 1 956 4 51 1 10 1 961 4 48 1 9 1 965 4 44 1 8 1 970 3 41 1 7 1 974 2 39 1 5 2 977 2 37 1 3 2 981 1 37 3 984 2 34 2 988 2 29 3 1 1 990 1 26 2 4 1 991 2 22 2 6 1 993 2 18 2 9 1 994 2 13 3 11 1 996 1 10 2 14 1 997 2 6 2 16 1 999 2 2 2 18 1 1001 2 21 1 1023 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1024 1 1023 1 1023 1 1024 1 1023 1 1023 1 1023 1 1024 1 1023 1 1024 1 1023 1 1024 1 1023 1 1024 1 1023 1 1024 1 1024 1 1023 1 1024 1 1023 1 1024 1 1023 1 1024 1 1023 1 1024 3 1024 4 1024 5 1024 4 1024 5 1024 5 1024 4 1024 5 1024 5 1024 6 1024 5 1024 5 1024 5 1024 6 1024 5 1024 6 1024 6 1024 6 1024 7 1024 6 1024 6 1024 7 1024 6 1024 6 1024 6 1024 5 1024 5 1024 5 1024 6 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 6 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 6 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 6 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 5 1024 6 1024 5 1024 5 1024 5 1024 3"


    test1 = "208490 6 965 17 27 26 944 85 937 97 130 14 781 104 70 73 775 111 58 82 770 120 47 90 763 265 757 269 752 274 747 277 743 282 737 286 734 290 730 293 728 295 727 297 724 299 723 300 722 302 720 303 720 303 720 302 720 303 719 304 718 305 717 306 716 307 715 308 715 309 713 310 712 311 710 313 709 315 707 316 706 317 706 317 705 318 704 320 702 321 702 321 701 323 699 324 698 326 696 327 695 329 693 331 691 333 689 334 688 336 686 337 685 339 682 341 681 343 679 345 677 347 675 349 672 351 669 354 668 356 665 358 662 361 660 364 658 366 656 368 653 370 651 372 651 373 649 374 647 376 645 379 644 379 643 381 642 381 641 382 640 384 638 385 637 386 636 388 634 390 631 393 630 393 630 394 628 395 627 397 625 398 625 399 623 400 623 401 622 401 621 402 621 402 620 404 619 404 619 403 620 402 621 401 622 400 623 399 624 398 625 398 625 397 626 397 626 397 626 396 627 396 627 395 628 394 629 394 630 392 631 392 631 391 633 389 634 389 634 389 634 390 634 389 634 389 634 389 634 390 634 389 634 389 634 388 635 388 636 387 636 387 636 387 637 386 637 386 637 386 638 386 637 386 638 386 637 386 637 387 636 388 636 387 636 387 636 388 636 387 637 387 636 387 637 386 637 387 637 386 637 386 637 386 638 385 638 385 639 385 638 385 639 384 639 385 638 385 639 384 639 384 639 383 641 382 642 381 643 381 643 381 643 381 643 380 643 380 644 379 644 379 645 378 646 378 645 379 645 379 644 380 644 379 645 377 647 376 648 373 650 370 654 367 657 366 658 366 658 365 659 364 660 363 660 363 661 362 662 361 662 361 663 360 663 359 665 358 666 357 667 355 668 354 670 352 672 350 674 349 675 348 675 348 676 347 677 346 678 344 680 342 681 341 683 340 684 338 686 337 687 335 688 334 690 332 692 330 694 327 697 322 702 314 710 313 711 312 712 309 715 304 720 301 723 299 725 295 729 290 734 288 736 286 738 285 739 284 740 282 742 281 743 280 744 280 744 279 745 279 745 278 746 277 747 277 747 276 748 275 749 274 750 274 749 274 750 273 751 271 753 270 754 269 755 268 757 266 758 265 759 263 761 262 763 260 764 260 765 258 766 257 767 257 768 255 769 255 769 255 769 255 769 254 770 253 772 251 773 251 773 250 774 249 775 248 776 248 777 246 778 245 779 245 779 244 781 242 782 241 784 240 784 239 786 237 787 236 788 236 788 235 790 233 791 232 793 230 795 228 796 227 798 226 798 225 799 224 800 223 802 222 802 221 804 219 806 217 807 217 808 215 809 214 811 213 811 213 812 212 812 211 814 209 815 209 816 207 818 205 819 205 820 204 820 204 820 203 821 202 822 202 822 201 823 200 823 200 824 200 823 200 824 199 824 200 823 199 825 197 826 195 831 191 835 187 839 183 843 179 852 169 857 165 863 159 875 147 882 135 895 127 903 117 916 105 929 93 941 79 951 68 966 52 978 40"
    test2 = "218477 3 1016 6 1016 5 1016 6 1015 7 1013 9 1011 11 1011 11 1010 12 1010 12 1010 12 1010 12 1010 12 1010 12 1010 12 1010 12 1010 13 1008 14 1008 15 1007 16 1006 16 1006 17 1005 17 1005 18 1004 19 1003 19 1003 20 1002 20 1002 21 1001 22 1000 22 1000 23 999 24 998 24 998 25 997 26 997 26 996 27 995 28 994 28 994 29 993 30 992 31 991 32 991 32 990 33 989 34 988 35 987 36 986 37 986 37 986 37 985 38 985 38 984 39 984 39 984 39 983 40 983 40 983 40 983 40 983 40 983 41 982 41 982 41 982 42 981 42 980 43 980 43 980 43 980 43 980 44 979 44 980 43 980 43 980 43 980 44 979 44 979 44 980 44 979 44 979 44 979 44 979 45 978 45 979 44 979 45 978 45 979 44 979 44 979 45 978 45 979 44 979 45 978 45 979 44 979 45 978 45 978 45 979 45 978 45 978 46 978 45 978 45 978 46 977 46 978 45 978 46 977 46 978 45 978 46 977 46 978 46 977 46 978 46 977 46 978 46 977 46 978 45 978 46 978 45 978 45 979 45 978 45 978 45 979 45 978 45 979 45 979 44 979 45 979 44 979 45 979 44 980 44 979 44 980 43 981 43 980 43 981 43 980 43 981 43 981 42 981 43 981 42 982 42 982 41 983 41 982 41 983 41 983 41 983 40 983 41 983 40 984 40 984 40 984 39 985 39 985 39 985 38 985 39 985 38 986 38 986 38 986 37 987 37 987 37 987 36 988 36 988 35 989 35 989 35 989 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 34 990 33 991 33 991 33 991 32 992 32 992 31 993 31 994 30 994 29 995 29 995 29 995 28 996 28 996 27 997 27 998 26 998 26 998 26 998 26 999 25 999 25 999 25 999 25 999 25 1000 24 1000 24 1001 23 1001 23 1002 23 1001 23 1002 22 1002 22 1003 22 1002 22 1003 21 1003 22 1002 22 1003 22 1002 22 1003 21 1003 22 1002 22 1003 22 1002 22 1003 22 1002 22 1002 23 1002 22 1002 23 1002 23 1001 24 1001 24 1000 25 1000 25 999 26 999 26 998 27 998 26 998 27 998 27 997 28 997 28 996 29 996 29 996 28 997 28 996 29 996 29 996 29 996 29 996 29 996 29 996 29 996 29 996 29 996 29 996 29 997 28 998 27 999 26 1000 24 1003 21 1005 19 1009 15 1013 11 1017 7 1021 3"

    #pneumo1 = "221609 13 1002 21 995 28 987 37 979 44 971 52 966 56 964 59 958 65 953 69 951 71 948 74 946 76 944 78 942 81 937 85 932 91 929 94 926 96 924 99 920 102 918 105 915 108 914 108 913 109 912 110 910 112 908 114 908 114 907 115 906 116 906 115 906 115 906 116 906 115 906 115 906 115 906 115 906 115 906 116 906 115 906 115 906 116 906 115 906 116 905 117 905 117 904 118 904 117 905 117 905 116 906 115 908 114 908 114 908 114 908 114 908 114 908 114 908 113 909 113 909 112 910 112 910 112 910 112 911 111 911 111 912 110 913 109 913 109 914 108 914 108 915 107 916 107 915 107 916 106 916 106 917 106 917 105 917 105 918 104 919 104 919 103 920 103 920 103 920 102 921 102 921 102 921 102 920 102 921 102 921 102 921 102 921 101 922 101 922 101 922 100 923 100 923 100 923 100 924 99 924 99 924 99 925 98 925 98 925 99 924 99 925 98 925 99 924 99 925 98 925 98 925 98 925 98 926 98 925 98 925 98 926 97 926 97 926 97 927 97 926 97 927 96 927 96 928 95 928 96 928 95 928 95 929 95 929 94 929 94 930 93 930 93 931 92 932 92 931 92 932 91 933 90 934 89 934 90 934 89 935 88 936 88 935 88 936 87 937 87 936 87 937 86 937 87 937 86 938 86 937 86 938 85 939 85 939 84 940 83 941 83 941 82 942 81 943 80 943 81 944 79 945 78 946 78 946 77 947 76 948 76 948 76 948 75 950 74 950 73 952 72 952 72 953 70 954 70 955 69 955 69 956 67 958 66 959 65 960 64 961 63 962 62 963 61 965 59 966 58 967 57 969 55 971 53 973 51 975 48 978 46 981 43 985 39 991 32 1000 24 1009 15 1020 4"
    #pneumo2 = "373863 11 1009 17 1003 22 1000 26 996 30 992 33 989 35 988 37 985 39 983 42 981 44 979 45 978 47 975 49 974 50 973 52 971 53 971 54 969 55 968 56 968 57 966 58 965 60 964 60 964 61 963 61 963 62 962 62 962 63 961 63 961 63 960 64 961 64 960 64 960 64 960 64 960 65 959 65 959 65 959 65 960 64 960 64 960 64 961 63 961 63 962 63 961 63 961 63 962 62 963 61 963 61 964 60 965 59 965 59 966 57 968 56 969 55 969 54 971 53 972 51 973 51 974 50 975 48 978 44 981 42 983 40 986 36 990 31 996 24 1002 15 1011 5"
    #pneumo1 = rle_decode_modified(pneumo1, (1024, 1024))
    #pneumo2 = rle_decode_modified(pneumo2, (1024, 1024))
    #pneumo1 = rle_decode(pneumo1, (1024, 1024))
    #pneumo2 = rle_decode(pneumo2, (1024, 1024))

    pn1 = "250542 11 1011 14 1009 15 1008 17 1005 20 1003 22 1002 21 1002 22 1002 21 1002 22 1001 22 1002 22 1001 22 1002 22 1002 21 1003 21 1003 20 1004 19 1005 19 1005 18 1005 19 1006 17 1007 17 1007 17 1007 16 1009 15 1009 15 1009 14 1010 14 1010 14 1011 12 1013 11 1013 11 1014 10 1015 9 1015 9 1016 8 1020 4"
    pn2 = "250542 11 1011 14 1009 15 1008 17 1005 20 1003 22 1002 21 1002 22 1002 21 1002 22 1001 22 1002 22 1001 22 1002 22 1002 21 1003 21 1003 20 1004 19 1005 19 1005 18 1005 19 1006 17 1007 17 1007 17 1007 16 1009 15 1009 15 1009 14 1010 14 1010 14 1011 12 1013 11 1013 11 1014 10 1015 9 1015 9 1016 8 1020 4"
    pn3 = "192189 13 1008 21 1002 25 997 29 994 32 992 33 991 34 1 1 988 36 988 36 988 36 988 37 987 37 987 37 987 38 987 37 988 37 987 37 988 36 989 35 990 34 991 33 994 30 996 28 998 26 999 25 999 25 999 25 999 25 999 25 998 26 997 27 997 27 996 28 995 29 995 28 996 28 995 28 996 28 995 28 996 28 996 27 997 27 996 27 997 26 997 27 996 27 997 26 997 25 998 25 998 24 999 23 1000 23 1001 21 1002 21 1002 20 1003 19 1005 17 1006 16 1007 15 1009 14 1009 14 1010 13 1010 14 1010 13 1011 13 1010 14 1010 13 1010 13 1011 13 1011 12 1011 13 1011 12 1011 13 1011 13 1011 12 1012 12 1012 11 1013 11 1013 11 1013 11 1013 11 1013 11 1014 10 1014 10 1014 10 1014 10 1014 10 1015 9 1015 9 1015 8 1016 8 1016 8 1016 7 1017 7 1017 6 1018 5 1022 2"
    pn4 = "201381 2 1021 3 1020 5 1018 6 1017 7 1016 9 1014 10 1015 10 1014 10 1014 10 1014 10 1015 9 1015 9 1015 9 1015 9 1020 4"
    pn5 = "166643 8 1011 18 1004 22 1000 26 996 30 991 34 988 36 985 40 982 43 979 47 975 50 972 53 970 56 966 59 963 60 962 12 21 29 959 11 28 26 955 11 34 24 952 11 39 21 957 5 42 20 1005 19 1005 19 1006 17 1008 15 1008 16 1007 16 1008 15 1008 16 1007 16 1007 16 1007 16 1007 17 1006 17 1007 16 1007 17 1006 17 1006 17 1007 16 1007 17 1006 17 1007 16 1007 17 1006 17 1007 16 1007 16 1008 15 1008 15 1009 14 1009 14 1009 14 1010 13 1010 13 1011 12 1012 11 1013 10 1013 10 1014 9 1015 8 1016 7 1016 7 1020 3"
    pn1 = rle_decode_modified(pn1, (1024, 1024))
    pn2 = rle_decode_modified(pn2, (1024, 1024))
    pn3 = rle_decode_modified(pn3, (1024, 1024))
    pn4 = rle_decode_modified(pn4, (1024, 1024))
    pn5 = rle_decode_modified(pn5, (1024, 1024))

    pneumo_tot = pn1 + pn2 + pn3 + pn4 + pn5

    pneumo_tot[pneumo_tot > 1] = 1

    #pneumo_added = pneumo1# + pneumo2

    test_rle = mask2rle(pneumo_tot)

    print(f"test rle: {test_rle}")
    pneumo_tot = rle_decode(test_rle, (1024, 1024))


    # segmentation_mask_org = np.uint8(mask1)
    #mask2 = rle_decode_modified(rib1, (1024, 1024))
    #mask3 = rle_decode_modified(rib2, (1024, 1024))
    #mask4 = rle_decode_modified(rib3, (1024, 1024))
    #mask5 = rle_decode_modified(tube, (1024, 1024))
    #mask_tot = mask1 + mask2 + mask3 + mask4 + (mask5 * 3)

    data_path = "Z:/public_datasets/candid_ptx/dataset1/dataset/"
    img_name = "8.5.93.945386.06.9.4.2.604267894259357.2236677287199.2"
    img_path = os.path.join(data_path, img_name)
    DCM_Img = pdcm.read_file(img_path)
    img_raw = DCM_Img.pixel_array
    img_raw = img_raw * (255 / np.amax(img_raw))  # puts the highest value at 255
    img_raw = np.uint8(img_raw)

    f, ax = plt.subplots(1, 3)
    ax[0].imshow(img_raw, cmap=plt.cm.bone)
    ax[0].set_title('Chest X-ray', size=20)
    ax[1].imshow(pneumo_tot, cmap=plt.cm.bone)
    ax[1].set_title('Physician Segmentation', size=20)
    ax[2].imshow(pneumo_tot, cmap="jet", alpha=1)
    # ax[2].title.set_text('Segmentation on X-Ray', size=10)
    ax[2].set_title('Segmentation on X-Ray', size=20)
    ax[2].imshow(img_raw, cmap=plt.cm.bone, alpha=.5)

    ax[0].axes.xaxis.set_visible(False)
    ax[0].axes.yaxis.set_visible(False)
    ax[1].axes.xaxis.set_visible(False)
    ax[1].axes.yaxis.set_visible(False)
    ax[2].axes.xaxis.set_visible(False)
    ax[2].axes.yaxis.set_visible(False)
    plt.show()
